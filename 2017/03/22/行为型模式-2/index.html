<!doctype html><html class="theme-next mist use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css" rel="stylesheet" type="text/css"><link href="//fonts.useso.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css"><meta name="keywords" content="软件设计模式 cpp,"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2"><meta name="description" content="迭代器模式（Iterator）、中介者模式（Mediator）、解释器模式（Interpreter）、状态模式（State）、责任链模式（Chain of Responsibility）、访问者模式（Visitor）"><meta property="og:type" content="article"><meta property="og:title" content="行为型模式(2)"><meta property="og:url" content="https://sambeauwang.github.io/2017/03/22/行为型模式-2/index.html"><meta property="og:site_name" content="Sambeau"><meta property="og:description" content="迭代器模式（Iterator）、中介者模式（Mediator）、解释器模式（Interpreter）、状态模式（State）、责任链模式（Chain of Responsibility）、访问者模式（Visitor）"><meta property="og:image" content="https://sambeauwang.github.io/pic/中介者模式.jpg"><meta property="og:image" content="https://sambeauwang.github.io/pic/责任连模式.jpg"><meta property="og:image" content="https://sambeauwang.github.io/pic/状态模式.gif"><meta property="og:image" content="https://sambeauwang.github.io/pic/访问者模式.jpg"><meta property="og:image" content="https://sambeauwang.github.io/pic/迭代器模式.gif"><meta property="og:image" content="https://sambeauwang.github.io/pic/解释器模式.jpg"><meta property="og:updated_time" content="2017-03-22T14:18:04.754Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="行为型模式(2)"><meta name="twitter:description" content="迭代器模式（Iterator）、中介者模式（Mediator）、解释器模式（Interpreter）、状态模式（State）、责任链模式（Chain of Responsibility）、访问者模式（Visitor）"><meta name="twitter:image" content="https://sambeauwang.github.io/pic/中介者模式.jpg"><script type="text/javascript" id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Mist",sidebar:{position:"left",display:"hide"},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"}}</script><link rel="canonical" href="https://sambeauwang.github.io/2017/03/22/行为型模式-2/"><title>行为型模式(2) | Sambeau</title></head><body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-86063343-1","auto"),ga("send","pageview")</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="//schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Sambeau</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section">首页</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section">分类</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section">归档</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section">标签</a></li><li class="menu-item menu-item-schedule"><a href="/schedule" rel="section">日程</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="st-search-show-outputs">搜索</a></li></ul><div class="site-search"><form class="site-search-form"><input type="text" id="st-search-input" class="st-search-input st-default-search-input"></form><script type="text/javascript">!function(t,e,n,s,c,a,i){t.SwiftypeObject=c,t[c]=t[c]||function(){(t[c].q=t[c].q||[]).push(arguments)},a=e.createElement(n),i=e.getElementsByTagName(n)[0],a.async=1,a.src=s,i.parentNode.insertBefore(a,i)}(window,document,"script","//s.swiftypecdn.com/install/v2/st.js","_st"),_st("install","YjoQj_U5CFYfraaUGKBM","2.0.0")</script></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="//schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline">行为型模式(2)</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time itemprop="dateCreated" datetime="2017-03-22T21:59:21+08:00" content="2017-03-22">2017-03-22 </time></span><span class="post-category">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/软件设计模式-cpp/" itemprop="url" rel="index"><span itemprop="name">软件设计模式 cpp</span> </a></span></span><span class="post-comments-count">&nbsp; | &nbsp; <a href="/2017/03/22/行为型模式-2/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/03/22/行为型模式-2/" itemprop="commentsCount"></span> </a></span><span id="/2017/03/22/行为型模式-2/" class="leancloud_visitors" data-flag-title="行为型模式(2)">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="行为型模式"><a href="#行为型模式" class="headerlink" title="行为型模式"></a>行为型模式</h3><p>包括：迭代器模式（Iterator）、中介者模式（Mediator）、解释器模式（Interpreter）、状态模式（State）、责任链模式（Chain of Responsibility）、访问者模式（Visitor）。</p><h3 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h3><p><strong>定义：</strong>用一个中介者对象封装一系列的对象交互，中介者使各对象不需要显示地相互作用，从而使耦合松散，而且可以独立地改变它们之间的交互。<br><strong>类图：</strong><br><img src="/pic/中介者模式.jpg" alt="中介者模式"></p><ul><li>抽象中介者：定义好同事类对象到中介者对象的接口，用于各个同事类之间的通信。一般包括一个或几个抽象的事件方法，并由子类去实现。</li><li>中介者实现类：从抽象中介者继承而来，实现抽象中介者中定义的事件方法。从一个同事类接收消息，然后通过消息影响其他同时类。</li><li>同事类：如果一个对象会影响其他的对象，同时也会被其他对象影响，那么这两个对象称为同事类。</li></ul><p>本文就以租房为例子，如果没有房屋中介，那么房客要自己找房东，而房东也要自己找房客，非常不方便。有了房屋中介机构就方便了。<br></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Mediator;</div><div class="line"><span class="comment">//抽象人</span></div><div class="line"><span class="keyword">class</span> Person</div><div class="line">&#123;</div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    Mediator *m_mediator; <span class="comment">//中介</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetMediator</span><span class="params">(Mediator *mediator)</span></span>&#123;&#125; <span class="comment">//设置中介</span></div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SendMessage</span><span class="params">(<span class="built_in">string</span> message)</span> </span>&#123;&#125;    <span class="comment">//向中介发送信息</span></div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">GetMessage</span><span class="params">(<span class="built_in">string</span> message)</span> </span>&#123;&#125;     <span class="comment">//从中介获取信息</span></div><div class="line">&#125;;</div><div class="line"><span class="comment">//抽象中介机构</span></div><div class="line"><span class="keyword">class</span> Mediator</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Send</span><span class="params">(<span class="built_in">string</span> message, Person *person)</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetA</span><span class="params">(Person *A)</span> </span>&#123;&#125;  <span class="comment">//设置其中一方</span></div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">SetB</span><span class="params">(Person *B)</span> </span>&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//租房者</span></div><div class="line"><span class="keyword">class</span> Renter: <span class="keyword">public</span> Person</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetMediator</span><span class="params">(Mediator *mediator)</span> </span>&#123; m_mediator = mediator; &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SendMessage</span><span class="params">(<span class="built_in">string</span> message)</span> </span>&#123; m_mediator-&gt;Send(message, <span class="keyword">this</span>); &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetMessage</span><span class="params">(<span class="built_in">string</span> message)</span> </span>&#123; <span class="built_in">cout</span>&lt;&lt;<span class="string">"租房者收到信息"</span>&lt;&lt;message; &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//房东</span></div><div class="line"><span class="keyword">class</span> Landlord: <span class="keyword">public</span> Person</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetMediator</span><span class="params">(Mediator *mediator)</span> </span>&#123; m_mediator = mediator; &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SendMessage</span><span class="params">(<span class="built_in">string</span> message)</span> </span>&#123; m_mediator-&gt;Send(message, <span class="keyword">this</span>); &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetMessage</span><span class="params">(<span class="built_in">string</span> message)</span> </span>&#123; <span class="built_in">cout</span>&lt;&lt;<span class="string">"房东收到信息："</span>&lt;&lt; message; &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//房屋中介</span></div><div class="line"><span class="keyword">class</span> HouseMediator : <span class="keyword">public</span> Mediator</div><div class="line">&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    Person *m_A; <span class="comment">//租房者</span></div><div class="line">    Person *m_B; <span class="comment">//房东</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    HouseMediator(): m_A(<span class="number">0</span>), m_B(<span class="number">0</span>) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetA</span><span class="params">(Person *A)</span> </span>&#123; m_A = A; &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetB</span><span class="params">(Person *B)</span> </span>&#123; m_B = B; &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Send</span><span class="params">(<span class="built_in">string</span> message, Person *person)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(person == m_A) <span class="comment">//租房者给房东发信息</span></div><div class="line">            m_B-&gt;GetMessage(message); <span class="comment">//房东收到信息</span></div><div class="line">        <span class="keyword">else</span></div><div class="line">            m_A-&gt;GetMessage(message);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 客户使用方式如下：</span></div><div class="line"><span class="comment">//测试案例</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    Mediator *mediator = <span class="keyword">new</span> HouseMediator();</div><div class="line">    Person *person1 = <span class="keyword">new</span> Renter();    <span class="comment">//租房者</span></div><div class="line">    Person *person2 = <span class="keyword">new</span> Landlord();  <span class="comment">//房东</span></div><div class="line">    mediator-&gt;SetA(person1);</div><div class="line">    mediator-&gt;SetB(person2);</div><div class="line">    person1-&gt;SetMediator(mediator);</div><div class="line">    person2-&gt;SetMediator(mediator);</div><div class="line">    person1-&gt;SendMessage(<span class="string">"我想在南京路附近租套房子，价格800元一个月\n"</span>);</div><div class="line">    person2-&gt;SendMessage(<span class="string">"出租房子：南京路100号，70平米，1000元一个月\n"</span>);</div><div class="line">    <span class="keyword">delete</span> person1; <span class="keyword">delete</span> person2; <span class="keyword">delete</span> mediator;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p><strong>适用场景:</strong><br>一般来说，只有对于那种同事类之间是网状结构的关系，才会考虑使用中介者模式。可以将网状结构变为星状结构，使同事类之间的关系变的清晰一些。</p><h3 id="责任连模式"><a href="#责任连模式" class="headerlink" title="责任连模式"></a>责任连模式</h3><p><strong>定义：</strong>使多个对象都有机会处理请求，从而避免了请求的发送者和接收者之间的耦合关系。将这些对象连成一条链，并沿着这条链传递该请求，直到有对象处理它为止。<br><strong>类图：</strong><br><img src="/pic/责任连模式.jpg" alt="责任连模式"></p><ul><li>抽象处理类：抽象处理类中主要包含一个指向下一处理类的成员变量nextHandler和一个处理请求的方法handRequest，handRequest方法的主要主要思想是，如果满足处理的条件，则有本处理类来进行处理，否则由nextHandler来处理。</li><li>具体处理类：具体处理类主要是对具体的处理逻辑和处理的适用条件进行实现。</li></ul><p>其思想很简单，考虑员工要求加薪。公司的管理者一共有三级，总经理、总监、经理，如果一个员工要求加薪，应该向主管的经理申请，如果加薪的数量在经理的职权内，那么经理可以直接批准，否则将申请上交给总监。<br></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//抽象管理者</span></div><div class="line"><span class="keyword">class</span> Manager</div><div class="line">&#123;</div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    Manager *m_manager;</div><div class="line">    <span class="built_in">string</span> m_name;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Manager(Manager *manager, <span class="built_in">string</span> name):m_manager(manager), m_name(name)&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DealWithRequest</span><span class="params">(<span class="built_in">string</span> name, <span class="keyword">int</span> num)</span>  </span>&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//经理</span></div><div class="line"><span class="keyword">class</span> CommonManager: <span class="keyword">public</span> Manager</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    CommonManager(Manager *manager, <span class="built_in">string</span> name):Manager(manager,name) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DealWithRequest</span><span class="params">(<span class="built_in">string</span> name, <span class="keyword">int</span> num)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(num &lt; <span class="number">500</span>) <span class="comment">//经理职权之内</span></div><div class="line">        &#123;</div><div class="line">            <span class="built_in">cout</span>&lt;&lt; <span class="string">"经理"</span> &lt;&lt; m_name &lt;&lt; <span class="string">"批准"</span> &lt;&lt; name &lt;&lt; <span class="string">"加薪"</span> &lt;&lt; num &lt;&lt; <span class="string">"元"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">"经理"</span>&lt;&lt;m_name&lt;&lt;<span class="string">"无法处理，交由总监处理"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">            m_manager-&gt;DealWithRequest(name, num);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//总监</span></div><div class="line"><span class="keyword">class</span> Majordomo: <span class="keyword">public</span> Manager</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Majordomo(Manager *manager, <span class="built_in">string</span> name):Manager(manager,name) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DealWithRequest</span><span class="params">(<span class="built_in">string</span> name, <span class="keyword">int</span> num)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(num &lt; <span class="number">1000</span>) <span class="comment">//总监职权之内</span></div><div class="line">        &#123;</div><div class="line">            <span class="built_in">cout</span>&lt;&lt; <span class="string">"总监"</span> &lt;&lt; m_name &lt;&lt; <span class="string">"批准"</span> &lt;&lt; name &lt;&lt; <span class="string">"加薪"</span> &lt;&lt; num &lt;&lt; <span class="string">"元"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">"总监"</span>&lt;&lt;m_name&lt;&lt;<span class="string">"无法处理，交由总经理处理"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">            m_manager-&gt;DealWithRequest(name, num);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//总经理</span></div><div class="line"><span class="keyword">class</span> GeneralManager: <span class="keyword">public</span> Manager</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    GeneralManager(Manager *manager, <span class="built_in">string</span> name):Manager(manager,name) &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DealWithRequest</span><span class="params">(<span class="built_in">string</span> name, <span class="keyword">int</span> num)</span>  <span class="comment">//总经理可以处理所有请求</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"总经理"</span>&lt;&lt; m_name&lt;&lt;<span class="string">"批准"</span>&lt;&lt; name &lt;&lt; <span class="string">"加薪"</span> &lt;&lt; num &lt;&lt; <span class="string">"元"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 客户调用方式为</span></div><div class="line"><span class="comment">//测试案例</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    Manager *general = <span class="keyword">new</span> GeneralManager(<span class="literal">NULL</span>, <span class="string">"A"</span>); <span class="comment">//设置上级，总经理没有上级</span></div><div class="line">    Manager *majordomo = <span class="keyword">new</span> Majordomo(general, <span class="string">"B"</span>); <span class="comment">//设置上级</span></div><div class="line">    Manager *common = <span class="keyword">new</span> CommonManager(majordomo, <span class="string">"C"</span>); <span class="comment">//设置上级</span></div><div class="line">    common-&gt;DealWithRequest(<span class="string">"D"</span>,<span class="number">300</span>);   <span class="comment">//员工D要求加薪</span></div><div class="line">    common-&gt;DealWithRequest(<span class="string">"E"</span>, <span class="number">600</span>);</div><div class="line">    common-&gt;DealWithRequest(<span class="string">"F"</span>, <span class="number">1000</span>);</div><div class="line">    <span class="keyword">delete</span> common; <span class="keyword">delete</span> majordomo; <span class="keyword">delete</span> general;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><h3 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h3><p>状态模式：允许一个对象在其内部状态改变时改变它的行为。对象看起来似乎修改了它的类。它有两种使用情况：（1）一个对象的行为取决于它的状态, 并且它必须在运行时刻根据状态改变它的行为。（2）一个操作中含有庞大的多分支的条件语句，且这些分支依赖于该对象的状态。<br><img src="/pic/状态模式.gif" alt="状态模式"></p><p>以战争为例，假设一场战争需经历四个阶段：前期、中期、后期、结束。<br></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> War;</div><div class="line"><span class="keyword">class</span> State</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Prophase</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Metaphase</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Anaphase</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">End</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">CurrentState</span><span class="params">(War *war)</span> </span>&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//战争</span></div><div class="line"><span class="keyword">class</span> War</div><div class="line">&#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    State *m_state;  <span class="comment">//目前状态</span></div><div class="line">    <span class="keyword">int</span> m_days;      <span class="comment">//战争持续时间</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    War(State *state): m_state(state), m_days(<span class="number">0</span>) &#123;&#125;</div><div class="line">    ~War() &#123; <span class="keyword">delete</span> m_state; &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">GetDays</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> m_days; &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetDays</span><span class="params">(<span class="keyword">int</span> days)</span> </span>&#123; m_days = days; &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">SetState</span><span class="params">(State *state)</span> </span>&#123; <span class="keyword">delete</span> m_state; m_state = state; &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetState</span><span class="params">()</span> </span>&#123; m_state-&gt;CurrentState(<span class="keyword">this</span>); &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//战争结束</span></div><div class="line"><span class="keyword">class</span> EndState: <span class="keyword">public</span> State</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">End</span><span class="params">(War *war)</span> <span class="comment">//结束阶段的具体行为</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"战争结束"</span>&lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CurrentState</span><span class="params">(War *war)</span> </span>&#123; End(war); &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//后期</span></div><div class="line"><span class="keyword">class</span> AnaphaseState: <span class="keyword">public</span> State</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Anaphase</span><span class="params">(War *war)</span> <span class="comment">//后期的具体行为</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(war-&gt;GetDays() &lt; <span class="number">30</span>)</div><div class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">"第"</span>&lt;&lt; war-&gt;GetDays()&lt;&lt;<span class="string">"天：战争后期，双方拼死一搏"</span>&lt;&lt; <span class="built_in">endl</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            war-&gt;SetState(<span class="keyword">new</span> EndState());</div><div class="line">            war-&gt;GetState();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CurrentState</span><span class="params">(War *war)</span> </span>&#123; Anaphase(war); &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//中期</span></div><div class="line"><span class="keyword">class</span> MetaphaseState: <span class="keyword">public</span> State</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Metaphase</span><span class="params">(War *war)</span> <span class="comment">//中期的具体行为</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(war-&gt;GetDays() &lt; <span class="number">20</span>)</div><div class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">"第"</span>&lt;&lt; war-&gt;GetDays()&lt;&lt;<span class="string">"天：战争中期，进入相持阶段，双发各有损耗"</span>&lt;&lt; <span class="built_in">endl</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            war-&gt;SetState(<span class="keyword">new</span> AnaphaseState());</div><div class="line">            war-&gt;GetState();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CurrentState</span><span class="params">(War *war)</span> </span>&#123; Metaphase(war); &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//前期</span></div><div class="line"><span class="keyword">class</span> ProphaseState: <span class="keyword">public</span> State</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Prophase</span><span class="params">(War *war)</span>  <span class="comment">//前期的具体行为</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(war-&gt;GetDays() &lt; <span class="number">10</span>)</div><div class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">"第"</span>&lt;&lt; war-&gt;GetDays() &lt;&lt;<span class="string">"天：战争初期，双方你来我往，互相试探对方"</span>&lt;&lt; <span class="built_in">endl</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            war-&gt;SetState(<span class="keyword">new</span> MetaphaseState());</div><div class="line">            war-&gt;GetState();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CurrentState</span><span class="params">(War *war)</span> </span>&#123; Prophase(war); &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//测试案例</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    War *war = <span class="keyword">new</span> War(<span class="keyword">new</span> ProphaseState());</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">40</span>;i += <span class="number">5</span>)</div><div class="line">    &#123;</div><div class="line">        war-&gt;SetDays(i);</div><div class="line">        war-&gt;GetState();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">delete</span> war;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><h3 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h3><p><strong>定义：</strong>封装某些作用于某种数据结构中各元素的操作，它可以在不改变数据结构的前提下定义作用于这些元素的新的操作。<br><strong>类图：</strong><br><img src="/pic/访问者模式.jpg" alt="访问者模式"></p><ul><li>抽象访问者：抽象类或者接口，声明访问者可以访问哪些元素，具体到程序中就是visit方法中的参数定义哪些对象是可以被访问的。</li><li>访问者：实现抽象访问者所声明的方法，它影响到访问者访问到一个类后该干什么，要做什么事情。</li><li>抽象元素类：接口或者抽象类，声明接受哪一类访问者访问，程序上是通过accept方法中的参数来定义的。抽象元素一般有两类方法，一部分是本身的业务逻辑，另外就是允许接收哪类访问者来访问。</li><li>元素类：实现抽象元素类所声明的accept方法，通常都是visitor.visit(this)，基本上已经形成一种定式了。</li><li>结构对象：一个元素的容器，一般包含一个容纳多个不同类、不同接口的容器，如List、Set、Map等，在项目中一般很少抽象出这个角色。<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> ConcreteElementA;</div><div class="line"><span class="keyword">class</span> ConcreteElementB;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Visitor</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">     <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">VisitConcreteElementA</span><span class="params">(ConcreteElementA *pElementA)</span> </span>= <span class="number">0</span>;</div><div class="line">     <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">VisitConcreteElementB</span><span class="params">(ConcreteElementB *pElementB)</span> </span>= <span class="number">0</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">class</span> ConcreteVisitor1 : <span class="keyword">public</span> Visitor</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteElementA</span><span class="params">(ConcreteElementA *pElementA)</span></span>;</div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteElementB</span><span class="params">(ConcreteElementB *pElementB)</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">void</span> ConcreteVisitor1::VisitConcreteElementA(ConcreteElementA *pElementA)</div><div class="line">&#123;</div><div class="line">     <span class="comment">// 现在根据传进来的pElementA，可以对ConcreteElementA中的element进行操作</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> ConcreteVisitor1::VisitConcreteElementB(ConcreteElementB *pElementB)</div><div class="line">&#123;</div><div class="line">     <span class="comment">// 现在根据传进来的pElementB，可以对ConcreteElementB中的element进行操作</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> ConcreteVisitor2 : <span class="keyword">public</span> Visitor</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteElementA</span><span class="params">(ConcreteElementA *pElementA)</span></span>;</div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteElementB</span><span class="params">(ConcreteElementB *pElementB)</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">void</span> ConcreteVisitor2::VisitConcreteElementA(ConcreteElementA *pElementA)</div><div class="line">&#123;</div><div class="line">     <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> ConcreteVisitor2::VisitConcreteElementB(ConcreteElementB *pElementB)</div><div class="line">&#123;</div><div class="line">     <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Element object</span></div><div class="line"><span class="keyword">class</span> Element</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">     <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Accept</span><span class="params">(Visitor *pVisitor)</span> </span>= <span class="number">0</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">class</span> ConcreteElementA : <span class="keyword">public</span> Element</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">Accept</span><span class="params">(Visitor *pVisitor)</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">void</span> ConcreteElementA::Accept(Visitor *pVisitor)</div><div class="line">&#123;</div><div class="line">     pVisitor-&gt;VisitConcreteElementA(<span class="keyword">this</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> ConcreteElementB : <span class="keyword">public</span> Element</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">Accept</span><span class="params">(Visitor *pVisitor)</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">void</span> ConcreteElementB::Accept(Visitor *pVisitor)</div><div class="line">&#123;</div><div class="line">     pVisitor-&gt;VisitConcreteElementB(<span class="keyword">this</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ObjectStructure类，能枚举它的元素，可以提供一个高层的接口以允许访问者访问它的元素</span></div><div class="line"><span class="keyword">class</span> ObjectStructure</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">Attach</span><span class="params">(Element *pElement)</span></span>;</div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">Detach</span><span class="params">(Element *pElement)</span></span>;</div><div class="line">     <span class="function"><span class="keyword">void</span> <span class="title">Accept</span><span class="params">(Visitor *pVisitor)</span></span>;</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">     <span class="built_in">vector</span>&lt;Element *&gt; elements;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">void</span> ObjectStructure::Attach(Element *pElement)</div><div class="line">&#123;</div><div class="line">     elements.push_back(pElement);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> ObjectStructure::Detach(Element *pElement)</div><div class="line">&#123;</div><div class="line">     <span class="built_in">vector</span>&lt;Element *&gt;::iterator it = find(elements.begin(), elements.end(), pElement);</div><div class="line">     <span class="keyword">if</span> (it != elements.end())</div><div class="line">     &#123;</div><div class="line">          elements.erase(it);</div><div class="line">     &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> ObjectStructure::Accept(Visitor *pVisitor)</div><div class="line">&#123;</div><div class="line">     <span class="comment">// 为每一个element设置visitor，进行对应的操作</span></div><div class="line">     <span class="keyword">for</span> (<span class="built_in">vector</span>&lt;Element *&gt;::const_iterator it = elements.begin(); it != elements.end(); ++it)</div><div class="line">     &#123;</div><div class="line">          (*it)-&gt;Accept(pVisitor);</div><div class="line">     &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">     ObjectStructure *pObject = <span class="keyword">new</span> ObjectStructure;</div><div class="line"></div><div class="line">     ConcreteElementA *pElementA = <span class="keyword">new</span> ConcreteElementA;</div><div class="line">     ConcreteElementB *pElementB = <span class="keyword">new</span> ConcreteElementB;</div><div class="line"></div><div class="line">     pObject-&gt;Attach(pElementA);</div><div class="line">     pObject-&gt;Attach(pElementB);</div><div class="line"></div><div class="line">     ConcreteVisitor1 *pVisitor1 = <span class="keyword">new</span> ConcreteVisitor1;</div><div class="line">     ConcreteVisitor2 *pVisitor2 = <span class="keyword">new</span> ConcreteVisitor2;</div><div class="line"></div><div class="line">     pObject-&gt;Accept(pVisitor1);</div><div class="line">     pObject-&gt;Accept(pVisitor2);</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (pVisitor2) <span class="keyword">delete</span> pVisitor2;</div><div class="line">     <span class="keyword">if</span> (pVisitor1) <span class="keyword">delete</span> pVisitor1;</div><div class="line">     <span class="keyword">if</span> (pElementB) <span class="keyword">delete</span> pElementB;</div><div class="line">     <span class="keyword">if</span> (pElementA) <span class="keyword">delete</span> pElementA;</div><div class="line">     <span class="keyword">if</span> (pObject) <span class="keyword">delete</span> pObject;</div><div class="line"></div><div class="line">     <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><p><strong>访问者模式的适用场景:</strong>假如一个对象中存在着一些与本对象不相干（或者关系较弱）的操作，为了避免这些操作污染这个对象，则可以使用访问者模式来把这些操作封装到访问者中去。</p><h3 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h3><p><strong>定义：</strong>提供一种方法访问一个容器对象中各个元素，而又不暴露该对象的内部细节。<br><strong>类图：</strong><br><img src="/pic/迭代器模式.gif" alt="迭代器模式"></p><ul><li>抽象容器：一般是一个接口，提供一个iterator()方法</li><li>具体容器：就是抽象容器的具体实现类，比如List接口的有序列表实现ArrayList，List接口的链表实现LinkList，Set接口的哈希列表的实现HashSet等。</li><li>抽象迭代器：定义遍历元素所需要的方法，一般来说会有这么三个方法：取得第一个元素的方法first()，取得下一个元素的方法next()，判断是否遍历结束的方法isDone()（或者叫hasNext()），移出当前对象的方法remove(),</li><li>迭代器实现：实现迭代器接口中定义的方法，完成集合的迭代。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Item&gt; <span class="comment">//迭代器角色</span></div><div class="line"><span class="keyword">class</span>  Iterator</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span> :</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">First</span><span class="params">()</span> </span>= <span class="number">0</span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Next</span><span class="params">()</span> </span>= <span class="number">0</span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> Item* <span class="title">CurrentItem</span><span class="params">()</span> </span>= <span class="number">0</span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">isDone</span><span class="params">()</span> </span>= <span class="number">0</span>;</div><div class="line">    <span class="keyword">virtual</span> ~Iterator()</div><div class="line">    &#123;&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Item&gt;<span class="comment">//集合角色</span></div><div class="line"><span class="keyword">class</span>  Aggregate</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">virtual</span> Iterator&lt;Item&gt;* CreateIterator() = <span class="number">0</span>;</div><div class="line">    <span class="keyword">virtual</span> ~Aggregate()</div><div class="line">    &#123;&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Item&gt;<span class="comment">//具体集合角色</span></div><div class="line"><span class="keyword">class</span> ConcreteAggregate : <span class="keyword">public</span> Aggregate&lt;Item&gt;</div><div class="line">&#123;</div><div class="line">    <span class="built_in">vector</span>&lt;Item&gt; data;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    ConcreteAggregate()</div><div class="line">    &#123;</div><div class="line">        data.push_back(<span class="number">1</span>);</div><div class="line">        data.push_back(<span class="number">2</span>);</div><div class="line">        data.push_back(<span class="number">3</span>);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">virtual</span> Iterator&lt;Item&gt;* CreateIterator()</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteIterator&lt;Item&gt;(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    Item&amp; <span class="keyword">operator</span>[](<span class="keyword">int</span> index)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> data[index];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">GetLen</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> data.size();</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Item&gt;</div><div class="line"><span class="keyword">class</span> ConcreteIterator : <span class="keyword">public</span> Iterator&lt;Item&gt; <span class="comment">//具体迭代器</span></div><div class="line">&#123;</div><div class="line">    ConcreteAggregate&lt;Item&gt;* aggr;</div><div class="line">    <span class="keyword">int</span> cur;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    ConcreteIterator(ConcreteAggregate&lt;Item&gt;* a)</div><div class="line">        :aggr(a)</div><div class="line">        , cur(<span class="number">0</span>)</div><div class="line">    &#123;&#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">First</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        cur = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Next</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (cur &lt; aggr-&gt;GetLen())</div><div class="line">            cur++;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> Item* <span class="title">CurrentItem</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (cur &lt; aggr-&gt;GetLen())</div><div class="line">            <span class="keyword">return</span>  &amp; (*aggr)[cur];<span class="comment">//aggr是指针所以需要先解引用再[]，最后返回元素地址</span></div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">isDone</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> (cur &gt;= aggr-&gt;GetLen());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure><h3 id="解释器模式"><a href="#解释器模式" class="headerlink" title="解释器模式"></a>解释器模式</h3><p><strong>定义：</strong>给定一种语言，定义他的文法的一种表示，并定义一个解释器，该解释器使用该表示来解释语言中句子。<br><strong>类图：</strong><br><img src="/pic/解释器模式.jpg" alt="解释器模式"></p><ul><li>抽象解释器：声明一个所有具体表达式都要实现的抽象接口（或者抽象类），接口中主要是一个interpret()方法，称为解释操作。具体解释任务由它的各个实现类来完成，具体的解释器分别由终结符解释器TerminalExpression和非终结符解释器NonterminalExpression完成。</li><li>终结符表达式：实现与文法中的元素相关联的解释操作，通常一个解释器模式中只有一个终结符表达式，但有多个实例，对应不同的终结符。终结符一半是文法中的运算单元，比如有一个简单的公式R=R1+R2，在里面R1和R2就是终结符，对应的解析R1和R2的解释器就是终结符表达式。</li><li>非终结符表达式：文法中的每条规则对应于一个非终结符表达式，非终结符表达式一般是文法中的运算符或者其他关键字，比如公式R=R1+R2中，+就是非终结符，解析+的解释器就是一个非终结符表达式。非终结符表达式根据逻辑的复杂程度而增加，原则上每个文法规则都对应一个非终结符表达式。</li><li>环境角色：这个角色的任务一般是用来存放文法中各个终结符所对应的具体值，比如R=R1+R2，我们给R1赋值100，给R2赋值200。这些信息需要存放到环境角色中，很多情况下我们使用Map来充当环境角色就足够了。</li></ul></div><div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/软件设计模式-cpp/" rel="tag">#软件设计模式 cpp</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/03/22/行为型模式-1/" rel="next" title="行为型模式(1)"><i class="fa fa-chevron-left"></i> 行为型模式(1)</a></div><div class="post-nav-prev post-nav-item"><a href="/2017/03/22/创建型模式/" rel="prev" title="创建型模式">创建型模式 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Sambeau Wang"><p class="site-author-name" itemprop="name">Sambeau Wang</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">21</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">5</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/SambeauWang" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub </a></span><span class="links-of-author-item"><a href="sambeauwang@gmail.com" target="_blank" title="Gmail"><i class="fa fa-fw fa-gmail"></i> Gmail</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#行为型模式"><span class="nav-number">1.</span> <span class="nav-text">行为型模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#中介者模式"><span class="nav-number">2.</span> <span class="nav-text">中介者模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#责任连模式"><span class="nav-number">3.</span> <span class="nav-text">责任连模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态模式"><span class="nav-number">4.</span> <span class="nav-text">状态模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#访问者模式"><span class="nav-number">5.</span> <span class="nav-text">访问者模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#迭代器模式"><span class="nav-number">6.</span> <span class="nav-text">迭代器模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解释器模式"><span class="nav-number">7.</span> <span class="nav-text">解释器模式</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2017</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Sambeau Wang</span></div><div class="powered-by"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>本站总访问量 <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp 您是第<span id="busuanzi_value_site_uv"></span>个来到的小伙伴</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script><script type="text/javascript">function run_disqus_script(s){var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src="//"+disqus_shortname+".disqus.com/"+s,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(i)}var disqus_shortname="sambeaublog.disqus.com/admin",disqus_identifier="2017/03/22/行为型模式-2/",disqus_title="行为型模式(2)",disqus_url="https://sambeauwang.github.io/2017/03/22/行为型模式-2/";run_disqus_script("count.js");var disqus_config=function(){this.page.url=disqus_url,this.page.identifier=disqus_identifier,this.page.title=disqus_title};run_disqus_script("embed.js")</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("MmTla9uHtyvAotAPz2aHArnn-gzGzoHsz","ppTjU9IN1rosOHlnsYjpxXJe")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html>