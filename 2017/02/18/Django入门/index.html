<!doctype html><html class="theme-next mist use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css" rel="stylesheet" type="text/css"><link href="//fonts.useso.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css"><meta name="keywords" content="Django,"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2"><meta name="description" content="Django入门"><meta property="og:type" content="article"><meta property="og:title" content="Django入门"><meta property="og:url" content="http://yoursite.com/2017/02/18/Django入门/index.html"><meta property="og:site_name" content="Sambeau"><meta property="og:description" content="Django入门"><meta property="og:updated_time" content="2017-02-18T03:11:03.767Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Django入门"><meta name="twitter:description" content="Django入门"><script type="text/javascript" id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Mist",sidebar:{position:"left",display:"hide"},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"}}</script><link rel="canonical" href="http://yoursite.com/2017/02/18/Django入门/"><title>Django入门 | Sambeau</title></head><body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-86063343-1","auto"),ga("send","pageview")</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="//schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Sambeau</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section">首页</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section">分类</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section">归档</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section">标签</a></li><li class="menu-item menu-item-schedule"><a href="/schedule" rel="section">日程</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="st-search-show-outputs">搜索</a></li></ul><div class="site-search"><form class="site-search-form"><input type="text" id="st-search-input" class="st-search-input st-default-search-input"></form><script type="text/javascript">!function(t,e,n,s,c,a,i){t.SwiftypeObject=c,t[c]=t[c]||function(){(t[c].q=t[c].q||[]).push(arguments)},a=e.createElement(n),i=e.getElementsByTagName(n)[0],a.async=1,a.src=s,i.parentNode.insertBefore(a,i)}(window,document,"script","//s.swiftypecdn.com/install/v2/st.js","_st"),_st("install","YjoQj_U5CFYfraaUGKBM","2.0.0")</script></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="//schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline">Django入门</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time itemprop="dateCreated" datetime="2017-02-18T09:47:19+08:00" content="2017-02-18">2017-02-18 </time></span><span class="post-category">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/Django/" itemprop="url" rel="index"><span itemprop="name">Django</span> </a></span></span><span class="post-comments-count">&nbsp; | &nbsp; <a href="/2017/02/18/Django入门/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/02/18/Django入门/" itemprop="commentsCount"></span> </a></span><span id="/2017/02/18/Django入门/" class="leancloud_visitors" data-flag-title="Django入门">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数 </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="1、安装python和Django"><a href="#1、安装python和Django" class="headerlink" title="1、安装python和Django"></a>1、安装python和Django</h2><h2 id="2、初始化项目："><a href="#2、初始化项目：" class="headerlink" title="2、初始化项目："></a>2、初始化项目：</h2><pre><code>`$django-admin.py startproject mysite`
生成文件：
    _init__.py(空文件):让Python把该目录当成一个开发包 (即一组模块)所需的文件
    manage.py ：一种命令行工具，允许你以多种方式与该 Django 项目进行交互。
    settings.py ：该 Django 项目的设置或配置。 查看并理解这个文件中可用的设置类型及其默认值。
    urls.py：Django项目的URL设置。可视其为你的django网站的目录。 目前，它是空的。
运行项目:
    `python manage.py runserver 8080`
</code></pre><p>在本地网络中的其它计算机就可以在浏览器中访问你的 IP 地址。比如：<a href="http://192.168.1.103:8000/" target="_blank" rel="external">http://192.168.1.103:8000/</a></p><h2 id="3、视图和URL配置"><a href="#3、视图和URL配置" class="headerlink" title="3、视图和URL配置"></a>3、视图和URL配置</h2><h3 id="1-创建一个views-py文件："><a href="#1-创建一个views-py文件：" class="headerlink" title="(1)创建一个views.py文件："></a>(1)创建一个views.py文件：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Hello world"</span>)</div></pre></td></tr></table></figure><p>一个视图就是Python的一个函数。这个函数第一个参数的类型是HttpRequest；它返回一个HttpResponse实例</p><h3 id="2-修改view-py-URLconf是-URL-模式以及要为该-URL-模式调用的视图函数之间的映射表。"><a href="#2-修改view-py-URLconf是-URL-模式以及要为该-URL-模式调用的视图函数之间的映射表。" class="headerlink" title="(2)修改view.py:URLconf是 URL 模式以及要为该 URL 模式调用的视图函数之间的映射表。"></a>(2)修改view.py:URLconf是 URL 模式以及要为该 URL 模式调用的视图函数之间的映射表。</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf.urls.defaults <span class="keyword">import</span> *</div><div class="line"></div><div class="line"><span class="comment"># Uncomment the next two lines to enable the admin:</span></div><div class="line"><span class="comment"># from django.contrib import admin</span></div><div class="line"><span class="comment"># admin.autodiscover()</span></div><div class="line"></div><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">     (<span class="string">'^hello/$'</span>, hello),</div><div class="line">    <span class="comment"># Example:</span></div><div class="line">    <span class="comment"># (r'^mysite/', include('mysite.foo.urls')),</span></div><div class="line"></div><div class="line">    <span class="comment"># Uncomment the admin/doc line below and add 'django.contrib.admindocs'</span></div><div class="line">    <span class="comment"># to INSTALLED_APPS to enable admin documentation:</span></div><div class="line">    <span class="comment"># (r'^admin/doc/', include('django.contrib.admindocs.urls')),</span></div><div class="line"></div><div class="line">    <span class="comment"># Uncomment the next line to enable the admin:</span></div><div class="line">    <span class="comment"># (r'^admin/', include(admin.site.urls)),</span></div><div class="line">)</div></pre></td></tr></table></figure><ul><li>patterns函数并将返回结果保存到urlpatterns变量。patterns函数当前只有一个参数—一个空的字符串（表示一个视图函数的通用前缀）</li><li>(‘^hello/$’, hello), 这行被称作URLpattern，它是一个Python的元组。元组中第一个元素是模式匹配字符串（正则表达式）；第二个元素是那个模式将使用的视图函数。</li></ul><h3 id="Ps"><a href="#Ps" class="headerlink" title="Ps:"></a>Ps:</h3><p>(1) Python 搜索路径 就是使用 import 语句时，Python 所查找的系统目录清单。<br>假定你将 Python 路径设置为 [‘’,’/usr/lib/python2.4/site-packages’,’/home/username/djcode/‘] 。如果执行代码 from foo import bar ，Python 将会首先在当前目录查找 foo.py 模块( Python 路径第一项的空字符串表示当前目录)。 如果文件不存在，Python将查找 /usr/lib/python2.4/site-packages/foo.py 文件。</p><p>(2) URLpattern的语法</p><ul><li>Django在检查URL模式前，移除每一个申请的URL开头的斜杠(/)。这意味着我们为/hello/写URL模式不用包含斜杠(/)。</li><li>尖号(^)要求表达式对字符串的头部进行匹配，美元符号($)则要求表达式对字符串的尾部进行匹配。</li></ul><p>(3) Django是怎么处理请求的:</p><ul><li>ROOT_URLCONF(默认ROOT_URLCONF = ‘mysite.urls’)告诉Django在这个站点的url配置文件(urls.py)</li></ul><h3 id="3-动态URL"><a href="#3-动态URL" class="headerlink" title="(3)动态URL"></a>(3)动态URL</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">urlpatterns = patterns(<span class="string">''</span>,</div><div class="line">    <span class="comment"># ...</span></div><div class="line">    (<span class="string">r'^time/plus/\d+/$'</span>, hours_ahead),</div><div class="line">    <span class="comment"># ...</span></div><div class="line">)</div></pre></td></tr></table></figure><p>一个URL模式就是一个正则表达式。因此，这里可以使用d+来匹配1个以上的数字。正则表达式字符串的开头字母“r”。 它告诉Python这是个原始字符串，不需要处理里面的反斜杠（转义字符）。<br>同时， 我们用一个视图函数就可以处理所有的时间段了。 我们使用圆括号把参数在URL模式里标识出来。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">## url.py</div><div class="line">from django.conf.urls.defaults import *</div><div class="line">from mysite.views import hello, current_datetime, hours_ahead</div><div class="line"></div><div class="line">urlpatterns = patterns(&apos;&apos;,</div><div class="line">    (r&apos;^hello/$&apos;, hello),</div><div class="line">    (r&apos;^time/$&apos;, current_datetime),</div><div class="line">    (r&apos;^time/plus/(\d&#123;1,2&#125;)/$&apos;, hours_ahead),</div><div class="line">)</div><div class="line"></div><div class="line">## view.py</div><div class="line">from django.http import Http404, HttpResponse</div><div class="line">import datetime</div><div class="line"></div><div class="line">def hours_ahead(request, offset):</div><div class="line">    try:</div><div class="line">        offset = int(offset)</div><div class="line">    except ValueError:</div><div class="line">        raise Http404()</div><div class="line">    dt = datetime.datetime.now() + datetime.timedelta(hours=offset)</div><div class="line">    html = &quot;&lt;html&gt;&lt;body&gt;In %s hour(s), it will be %s.&lt;/body&gt;&lt;/html&gt;&quot; % (offset, dt)</div><div class="line">    return HttpResponse(html)</div></pre></td></tr></table></figure><p></p><p>offset 是从匹配的URL里提取出来的。 例如：如果请求URL是/time/plus/3/，那么offset将会是3；如果请求URL是/time/plus/21/，那么offset将会是21。</p><h2 id="4、模板"><a href="#4、模板" class="headerlink" title="4、模板"></a>4、模板</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Ordering notice<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Ordering notice<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Dear &#123;&#123; person_name &#125;&#125;,<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Thanks for placing an order from &#123;&#123; company &#125;&#125;. It's scheduled to</div><div class="line"><span class="comment">&lt;!-- 这个例子中的&#123;&#123;ship_date|date:”F j, Y” &#125;&#125;，我们将变量ship_date传递给date过滤器，同时指定参数”F j,Y”。 --&gt;</span></div><div class="line">ship on &#123;&#123; ship_date|date:"F j, Y" &#125;&#125;.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Here are the items you've ordered:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">&#123;% for item in item_list %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">&#123;% endfor %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"></div><div class="line">&#123;% if ordered_warranty %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Your warranty information will be included in the packaging.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">&#123;% else %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>You didn't order a warranty, so you're on your own when</div><div class="line">    the products inevitably stop working.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">&#123;% endif %&#125;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Sincerely,<span class="tag">&lt;<span class="name">br</span> /&gt;</span>&#123;&#123; company &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure><h3 id="1-Python代码中使用Django模板的最基本方式如下："><a href="#1-Python代码中使用Django模板的最基本方式如下：" class="headerlink" title="(1)Python代码中使用Django模板的最基本方式如下："></a>(1)Python代码中使用Django模板的最基本方式如下：</h3><ul><li>可以用原始的模板代码字符串创建一个 Template 对象， Django同样支持用指定模板文件路径的方式来创建 Template 对象;</li><li>调用模板对象的render方法，并且传入一套变量context。它将返回一个基于模板的展现字符串，模板中的变量和标签会被context值替换。<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django <span class="keyword">import</span> template</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>t = template.Template(<span class="string">'My name is &#123;&#123; name &#125;&#125;.'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = template.Context(&#123;<span class="string">'name'</span>: <span class="string">'Adrian'</span>&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> t.render(c)</div><div class="line">My name <span class="keyword">is</span> Adrian.</div></pre></td></tr></table></figure></li></ul><p>Ps:<br>1、输入命令 python manage.py shell 启动交互界面。在启动解释器之前，它告诉Django使用哪个设置文件。 Django框架的大部分子系统，包括模板系统，都依赖于配置文件。</p><h3 id="2-模板渲染"><a href="#2-模板渲染" class="headerlink" title="(2)模板渲染"></a>(2)模板渲染</h3><p>context在Django里表现为 Context 类，在 django.template 模块里。 她的构造函数带有一个可选的参数： 一个字典映射变量和它们的值。 调用 Template 对象 的 render() 方法并传递context来填充模板：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from django.template import Context, Template</div><div class="line">&gt;&gt;&gt; t = Template(&apos;My name is &#123;&#123; name &#125;&#125;.&apos;)</div><div class="line">&gt;&gt;&gt; c = Context(&#123;&apos;name&apos;: &apos;Stephane&apos;&#125;)</div><div class="line">&gt;&gt;&gt; t.render(c)</div><div class="line">u&apos;My name is Stephane.&apos;     #返回的值是一个Unicode对象</div></pre></td></tr></table></figure><p></p><p>Ps:<br>假设你要向模板传递一个 Python 字典。 要通过字典键访问该字典的值，可使用一个句点<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from django.template import Template, Context</div><div class="line">&gt;&gt;&gt; person = &#123;&apos;name&apos;: &apos;Sally&apos;, &apos;age&apos;: &apos;43&apos;&#125;</div><div class="line">&gt;&gt;&gt; t = Template(&apos;&#123;&#123; person.name &#125;&#125; is &#123;&#123; person.age &#125;&#125; years old.&apos;)</div><div class="line">&gt;&gt;&gt; c = Context(&#123;&apos;person&apos;: person&#125;)</div><div class="line">&gt;&gt;&gt; t.render(c)</div><div class="line">u&apos;Sally is 43 years old.&apos;</div><div class="line"></div><div class="line">### 自定义类</div><div class="line">&gt;&gt;&gt; from django.template import Template, Context</div><div class="line">&gt;&gt;&gt; class Person(object):</div><div class="line">...     def __init__(self, first_name, last_name):</div><div class="line">...         self.first_name, self.last_name = first_name, last_name</div><div class="line">&gt;&gt;&gt; t = Template(&apos;Hello, &#123;&#123; person.first_name &#125;&#125; &#123;&#123; person.last_name &#125;&#125;.&apos;)</div><div class="line">&gt;&gt;&gt; c = Context(&#123;&apos;person&apos;: Person(&apos;John&apos;, &apos;Smith&apos;)&#125;)</div><div class="line">&gt;&gt;&gt; t.render(c)</div><div class="line">u&apos;Hello, John Smith.&apos;</div><div class="line"></div><div class="line">### 引用对象的方法</div><div class="line">&gt;&gt;&gt; from django.template import Template, Context</div><div class="line">&gt;&gt;&gt; t = Template(&apos;&#123;&#123; var &#125;&#125; -- &#123;&#123; var.upper &#125;&#125; -- &#123;&#123; var.isdigit &#125;&#125;&apos;)</div><div class="line">&gt;&gt;&gt; t.render(Context(&#123;&apos;var&apos;: &apos;hello&apos;&#125;))</div><div class="line">u&apos;hello -- HELLO -- False&apos;</div><div class="line">&gt;&gt;&gt; t.render(Context(&#123;&apos;var&apos;: &apos;123&apos;&#125;))</div><div class="line">u&apos;123 -- 123 -- True&apos;</div></pre></td></tr></table></figure><p></p><h3 id="3-标签"><a href="#3-标签" class="headerlink" title="(3)标签"></a>(3)标签</h3><h3 id="4-过滤器"><a href="#4-过滤器" class="headerlink" title="(4)过滤器"></a>(4)过滤器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 显示的内容是变量 &#123;&#123; name &#125;&#125; 被过滤器 lower 处理后的结果</span></div><div class="line">&#123;&#123; name|lower &#125;&#125;</div><div class="line"></div><div class="line"><span class="comment"># 一个过滤器管道的输出又可以作为下一个管道的输入</span></div><div class="line">&#123;&#123; my_list|first|upper &#125;&#125;</div><div class="line"></div><div class="line"><span class="comment"># 过滤器的参数跟随冒号之后并且总是以双引号包含</span></div><div class="line">&#123;&#123; bio|truncatewords:<span class="string">"30"</span> &#125;&#125;        <span class="comment"># 这个将显示变量 bio 的前30个词。</span></div></pre></td></tr></table></figure><h3 id="5-在视图中使用模板"><a href="#5-在视图中使用模板" class="headerlink" title="(5)在视图中使用模板"></a>(5)在视图中使用模板</h3><p>模板加载的路径: 要使用模板加载API，首先你必须将模板的保存位置.(在ROOT_URLCONF配置的settings.py做修改)<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os.path</div><div class="line"></div><div class="line">TEMPLATE_DIRS = (</div><div class="line">    os.path.join(os.path.dirname(__file__), <span class="string">'templates'</span>).replace(<span class="string">'\\'</span>,<span class="string">'/'</span>),</div><div class="line">)</div></pre></td></tr></table></figure><p></p><p>Python 内部变量<code>__file__</code>，该变量被自动设置为代码所在的 Python 模块文件名。 <code>os.path.dirname(__file__)</code> 将会获取自身所在的文件，即settings.py 所在的目录，然后由os.path.join 这个方法将这目录与 templates 进行连接。</p><h5 id="修改视图代码"><a href="#修改视图代码" class="headerlink" title="修改视图代码"></a>修改视图代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">from django.template.loader import get_template</div><div class="line">from django.template import Context</div><div class="line">from django.http import HttpResponse</div><div class="line">import datetime</div><div class="line"></div><div class="line">def current_datetime(request):</div><div class="line">    now = datetime.datetime.now()</div><div class="line">    # get_template() 函数以模板名称为参数，在文件系统中找出模块的位置，打开文件并返回一个编译好的 Template 对象。</div><div class="line">    t = get_template(&apos;current_datetime.html&apos;)</div><div class="line">    html = t.render(Context(&#123;&apos;current_date&apos;: now&#125;))</div><div class="line">    return HttpResponse(html)</div></pre></td></tr></table></figure><h5 id="render-to-response"><a href="#render-to-response" class="headerlink" title="render_to_response"></a>render_to_response</h5><p>载入一个模板文件，然后用 Context渲染它，最后返回这个处理好的HttpResponse对象给用户。我们使用get_template() 方法代替<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">from django.shortcuts import render_to_response</div><div class="line">import datetime</div><div class="line"></div><div class="line">def current_datetime(request):</div><div class="line">    now = datetime.datetime.now()</div><div class="line">    return render_to_response(&apos;current_datetime.html&apos;, &#123;&apos;current_date&apos;: now&#125;)</div></pre></td></tr></table></figure><p></p><p>Python 的内建函数 locals() 。它返回的字典对所有局部变量的名称与值进行映射。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def current_datetime(request):</div><div class="line">    current_date = datetime.datetime.now()</div><div class="line">    return render_to_response(&apos;current_datetime.html&apos;, locals())</div></pre></td></tr></table></figure><p></p><h3 id="6-include模板标签"><a href="#6-include模板标签" class="headerlink" title="(6)include模板标签"></a>(6)include模板标签</h3><p>该标签允许在（模板中）包含其它的模板的内容。 标签的参数是所要包含的模板名称，可以是一个变量，也可以是用单/双引号硬编码的字符串。和在 get_template() 中一样， 对模板的文件名进行判断时会在所调取的模板名称之前加上来自 TEMPLATE_DIRS 的模板目录。<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># mypage.html</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">&#123;% include "includes/nav.html" %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line"># includes/nav.html</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"nav"</span>&gt;</span></div><div class="line">    You are in: &#123;&#123; current_section &#125;&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure><p></p><h3 id="7-模板继承"><a href="#7-模板继承" class="headerlink" title="(7)模板继承"></a>(7)模板继承</h3><p>模板继承就是先构造一个基础框架模板，而后在其子模板中对它所包含站点公用部分和定义块进行重载。<br><strong>第一步是定义基础模板</strong><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock %&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>My helpful timestamp site<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    &#123;% block content %&#125;&#123;% endblock %&#125;</div><div class="line">    &#123;% block footer %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Thanks for visiting my site.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    &#123;% endblock %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure><p></p><p>所有的<code>block</code>标签告诉模板引擎，子模板可以重载这些部分。 每个<code>block</code>标签所要做的是告诉模板引擎，该模板下的这一块内容将有可能被子模板覆盖。<br><strong>第二步是修改 current_datetime.html 模板来使用它</strong><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;% extends "base.html" %&#125;</div><div class="line"></div><div class="line">&#123;% block title %&#125;The current time&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block content %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>It is now &#123;&#123; current_date &#125;&#125;.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure><p></p><h3 id="5、模型"><a href="#5、模型" class="headerlink" title="5、模型"></a>5、模型</h3><h5 id="1-MTV-开发模式"><a href="#1-MTV-开发模式" class="headerlink" title="(1) MTV 开发模式"></a>(1) MTV 开发模式</h5><ul><li>M ，数据存取部分，由django数据库层处理。</li><li>V ，选择显示哪些数据要显示以及怎样显示的部分，由视图和模板处理。</li><li>C ，根据用户输入委派视图的部分，由 Django 框架根据 URLconf 设置，对给定 URL 调用适当的 Python 函数。</li></ul><h5 id="2-数据库配置"><a href="#2-数据库配置" class="headerlink" title="(2) 数据库配置"></a>(2) 数据库配置</h5><p>TEMPLATE_DIRS 一样，数据库配置也是在Django的配置文件里，缺省是settings.py 。</p><ul><li>DATABASE_ENGINE = ‘postgresql_psycopg2’ # DATABASE_ENGINE 告诉Django使用哪个数据库引擎</li><li>DATABASE_NAME = ‘mydb’ # DATABASE_NAME 将数据库名称告知 Django</li><li>DATABASE_NAME = ‘/home/django/mydata.db’ # 如果使用 SQLite，请对数据库文件指定完整的文件系统路径</li><li>DATABASE_USER 告诉 Django 用哪个用户连接数据库</li><li>DATABASE_PASSWORD 告诉Django连接用户的密码。 SQLite 用空密码即可。</li><li>DATABASE_HOST 告诉 Django 连接哪一台主机的数据库服务器。</li></ul><p>#####Ps:<br>如果使用的是 MySQL 且该项设置值由斜杠（ ‘/‘ ）开头，MySQL 将通过 Unix socket 来连接指定的套接字，例如：<br><code>DATABASE_HOST = &#39;/var/run/mysql&#39;</code></p><p>我们可以在”mysite”项目目录下执行上章所提到的”python manage.py shell”来进行测试。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.db <span class="keyword">import</span> connection</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cursor = connection.cursor()</div></pre></td></tr></table></figure><p></p><h3 id="3-project和app之间的区别"><a href="#3-project和app之间的区别" class="headerlink" title="(3)project和app之间的区别"></a>(3)project和app之间的区别</h3><p>一个project包含很多个Djangoapp以及对它们的配置。一个app是一套Django功能的集合，通常包括模型和视图，按Python的包结构的方式存在。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ python manage.py startapp books</div><div class="line"></div><div class="line"><span class="comment"># 在 mysite 的目录里创建了一个 books 目录</span></div><div class="line">books/</div><div class="line">    __init__.py</div><div class="line">    models.py</div><div class="line">    tests.py</div><div class="line">    views.py</div></pre></td></tr></table></figure><p></p><h3 id="4-第一个模型-书籍-作者-出版商-数据库结构"><a href="#4-第一个模型-书籍-作者-出版商-数据库结构" class="headerlink" title="(4)第一个模型(书籍/作者/出版商 数据库结构)"></a>(4)第一个模型(书籍/作者/出版商 数据库结构)</h3><h5 id="模型定义"><a href="#模型定义" class="headerlink" title="模型定义"></a>模型定义</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publisher</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    address = models.CharField(max_length=<span class="number">50</span>)</div><div class="line">    city = models.CharField(max_length=<span class="number">60</span>)</div><div class="line">    state_province = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    country = models.CharField(max_length=<span class="number">50</span>)</div><div class="line">    website = models.URLField()</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></div><div class="line">    first_name = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    last_name = models.CharField(max_length=<span class="number">40</span>)</div><div class="line">    email = models.EmailField()</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></div><div class="line">    title = models.CharField(max_length=<span class="number">100</span>)</div><div class="line">    authors = models.ManyToManyField(Author)</div><div class="line">    publisher = models.ForeignKey(Publisher)</div><div class="line">    publication_date = models.DateField()</div></pre></td></tr></table></figure><p>每个模型相当于单个数据库表，每个属性也是这个表中的一个字段。 属性名就是字段名，它的类型（例如 CharField ）相当于数据库的字段类型 （例如 varchar ）。</p><h5 id="模型安装"><a href="#模型安装" class="headerlink" title="模型安装"></a>模型安装</h5><p>(1)在 Django 项目中激活这些模型,编辑 settings.py 文件， 找到 INSTALLED_APPS 设置。 INSTALLED_APPS 告诉 Django 项目哪些 app 处于激活状态。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">MIDDLEWARE_CLASSES = (</div><div class="line">    # &apos;django.middleware.common.CommonMiddleware&apos;,</div><div class="line">    # &apos;django.contrib.sessions.middleware.SessionMiddleware&apos;,</div><div class="line">    # &apos;django.contrib.auth.middleware.AuthenticationMiddleware&apos;,</div><div class="line">)</div><div class="line"></div><div class="line">INSTALLED_APPS = (</div><div class="line">    # &apos;django.contrib.auth&apos;,</div><div class="line">    # &apos;django.contrib.contenttypes&apos;,</div><div class="line">    # &apos;django.contrib.sessions&apos;,</div><div class="line">    # &apos;django.contrib.sites&apos;,</div><div class="line">    &apos;mysite.books&apos;,</div><div class="line">)</div></pre></td></tr></table></figure><p></p><p>(2)验证模型的有效性<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python manage.py validate</div></pre></td></tr></table></figure><p></p><p>(3)生成 CREATE TABLE 语句(只是把SQL语句段打印出来)<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">python manage.py sqlall books</div><div class="line"></div><div class="line"># 输出</div><div class="line"></div><div class="line">BEGIN;</div><div class="line">CREATE TABLE &quot;books_publisher&quot; (</div><div class="line">    &quot;id&quot; serial NOT NULL PRIMARY KEY,</div><div class="line">    &quot;name&quot; varchar(30) NOT NULL,</div><div class="line">    &quot;address&quot; varchar(50) NOT NULL,</div><div class="line">    &quot;city&quot; varchar(60) NOT NULL,</div><div class="line">    &quot;state_province&quot; varchar(30) NOT NULL,</div><div class="line">    &quot;country&quot; varchar(50) NOT NULL,</div><div class="line">    &quot;website&quot; varchar(200) NOT NULL</div><div class="line">)</div><div class="line">;</div><div class="line">CREATE TABLE &quot;books_author&quot; (</div><div class="line">    &quot;id&quot; serial NOT NULL PRIMARY KEY,</div><div class="line">    &quot;first_name&quot; varchar(30) NOT NULL,</div><div class="line">    &quot;last_name&quot; varchar(40) NOT NULL,</div><div class="line">    &quot;email&quot; varchar(75) NOT NULL</div><div class="line">)</div><div class="line">;</div><div class="line">CREATE TABLE &quot;books_book&quot; (</div><div class="line">    &quot;id&quot; serial NOT NULL PRIMARY KEY,</div><div class="line">    &quot;title&quot; varchar(100) NOT NULL,</div><div class="line">    &quot;publisher_id&quot; integer NOT NULL REFERENCES &quot;books_publisher&quot; (&quot;id&quot;) DEFERRABLE INITIALLY DEFERRED,</div><div class="line">    &quot;publication_date&quot; date NOT NULL</div><div class="line">)</div><div class="line">;</div><div class="line">CREATE TABLE &quot;books_book_authors&quot; (</div><div class="line">    &quot;id&quot; serial NOT NULL PRIMARY KEY,</div><div class="line">    &quot;book_id&quot; integer NOT NULL REFERENCES &quot;books_book&quot; (&quot;id&quot;) DEFERRABLE INITIALLY DEFERRED,</div><div class="line">    &quot;author_id&quot; integer NOT NULL REFERENCES &quot;books_author&quot; (&quot;id&quot;) DEFERRABLE INITIALLY DEFERRED,</div><div class="line">    UNIQUE (&quot;book_id&quot;, &quot;author_id&quot;)</div><div class="line">)</div><div class="line">;</div><div class="line">CREATE INDEX &quot;books_book_publisher_id&quot; ON &quot;books_book&quot; (&quot;publisher_id&quot;);</div><div class="line">COMMIT;</div></pre></td></tr></table></figure><p></p><ul><li>自动生成的表名是app名称（ books ）和模型的小写名称 （ publisher , book , author )的组合。</li><li>Django为每个表格自动添加加了一个 id 主键， 你可以重新设置它。</li><li>外键是用 REFERENCES 语句明确定义的。</li></ul><p><code>提交SQL语句至数据库的方法</code><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python manage.py syncdb</div></pre></td></tr></table></figure><p></p><p>根据 INSTALLED_APPS 里设置的app来检查数据库， 如果表不存在，它就会创建它。 需要注意的是， syncdb 并 不能将模型的修改或删除同步到数据库；如果你修改或删除了一个模型，并想把它提交到数据库，syncdb并不会做出任何处理。</p><h3 id="5-基本数据访问"><a href="#5-基本数据访问" class="headerlink" title="(5)基本数据访问"></a>(5)基本数据访问</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 导入Publisher模型类， 通过这个类我们可以与包含 出版社 的数据表进行交互。</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> books.models <span class="keyword">import</span> Publisher</div><div class="line"><span class="comment"># 创建一个`` Publisher`` 类的实例并设置了字段`` name, address`` 等的值。调用该对象的 save() 方法，将对象保存到数据库中。 Django 会在后台执行一条 INSERT 语句。</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>p1 = Publisher(name=<span class="string">'Apress'</span>, address=<span class="string">'2855 Telegraph Avenue'</span>,</div><div class="line"><span class="meta">... </span>    city=<span class="string">'Berkeley'</span>, state_province=<span class="string">'CA'</span>, country=<span class="string">'U.S.A.'</span>,</div><div class="line"><span class="meta">... </span>    website=<span class="string">'http://www.apress.com/'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>p1.save()</div><div class="line"><span class="comment"># 调用`` Publisher.objects.all()`` 方法获取数据库中`` Publisher`` 类的所有对象。</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>publisher_list = Publisher.objects.all()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>publisher_list</div><div class="line">[&lt;Publisher: Publisher object&gt;, &lt;Publisher: Publisher object&gt;]</div></pre></td></tr></table></figure><h5 id="添加模块的字符串表现"><a href="#添加模块的字符串表现" class="headerlink" title="添加模块的字符串表现"></a>添加模块的字符串表现</h5><p>Publisher对象添加一个方法<code>__unicode__()</code>,告诉Python如何将对象以unicode的方式显示出来。<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publisher</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    address = models.CharField(max_length=<span class="number">50</span>)</div><div class="line">    city = models.CharField(max_length=<span class="number">60</span>)</div><div class="line">    state_province = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    country = models.CharField(max_length=<span class="number">50</span>)</div><div class="line">    website = models.URLField()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.name</div></pre></td></tr></table></figure><p></p><h5 id="插入和更新数据"><a href="#插入和更新数据" class="headerlink" title="插入和更新数据"></a>插入和更新数据</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 更新一行里的所有列</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>p = Publisher.objects.get(name=<span class="string">'Apress'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>p.name = <span class="string">'Apress Publishing'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>p.save()</div><div class="line"></div><div class="line"><span class="comment"># 更改某一指定的列</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Publisher.objects.filter(id=<span class="number">52</span>).update(name=<span class="string">'Apress Publishing'</span>)</div></pre></td></tr></table></figure><p>update()方法对于任何结果集（QuerySet）均有效，这意味着你可以同时更新多条记录。</p><h5 id="选择对象"><a href="#选择对象" class="headerlink" title="选择对象"></a>选择对象</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"># 查找整个表</div><div class="line">&gt;&gt;&gt; Publisher.objects.all()</div><div class="line">[&lt;Publisher: Apress&gt;, &lt;Publisher: O'Reilly&gt;]</div><div class="line"># objects属性称为管理器，管理着所有针对数据包含、还有最重要的数据查询的表格级操作。</div><div class="line"># all()返回返回数据库中所有的记录，一个 QuerySet 对象</div><div class="line"></div><div class="line">&gt;&gt;&gt; Publisher.objects.filter(name='Apress')</div><div class="line"># SELECT id, name, address, city, state_province, country, website</div><div class="line"># FROM books_publisher</div><div class="line"># WHERE name = 'Apress';</div><div class="line"></div><div class="line">&gt;&gt;&gt; Publisher.objects.filter(name__contains="press")</div><div class="line"># 在 name 和 contains 之间有双下划线。Django也使用双下划线来表明会进行一些魔术般的操作。</div><div class="line"># SELECT id, name, address, city, state_province, country, website</div><div class="line"># FROM books_publisher</div><div class="line"># WHERE name LIKE '%press%';</div><div class="line"></div><div class="line"># 获取单个对象</div><div class="line">&gt;&gt;&gt; Publisher.objects.get(name="Apress")</div><div class="line"># 就返回了单个对象(QuerySet)。如果结果是多个对象或没有返回结果，会导致抛出异常</div><div class="line"># 改进处理</div><div class="line">try:</div><div class="line">    p = Publisher.objects.get(name='Apress')</div><div class="line">except Publisher.DoesNotExist:</div><div class="line">    print "Apress isn't in the database yet."</div><div class="line">else:</div><div class="line">    print "Apress is in the database."</div></pre></td></tr></table></figure><h5 id="数据排序"><a href="#数据排序" class="headerlink" title="数据排序"></a>数据排序</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>Publisher.objects.order_by(<span class="string">"name"</span>)</div><div class="line"><span class="comment"># SELECT id, name, address, city, state_province, country, website</span></div><div class="line"><span class="comment"># FROM books_publisher</span></div><div class="line"><span class="comment"># ORDER BY name;</span></div><div class="line"><span class="comment"># 指定逆向排序，在前面加一个减号 - 前缀：</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Publisher.objects.order_by(<span class="string">"-name"</span>)</div></pre></td></tr></table></figure><p>指定模型的缺省排序方式<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publisher</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.name</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        ordering = [<span class="string">'name'</span>]</div></pre></td></tr></table></figure><p></p><p>在任意一个模型类中使用 Meta 类，来设置一些与特定模型相关的选项。</p><h5 id="连锁查询"><a href="#连锁查询" class="headerlink" title="连锁查询"></a>连锁查询</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>Publisher.objects.filter(country=<span class="string">"U.S.A."</span>).order_by(<span class="string">"-name"</span>)</div><div class="line"></div><div class="line"><span class="comment"># SELECT id, name, address, city, state_province, country, website</span></div><div class="line"><span class="comment"># FROM books_publisher</span></div><div class="line"><span class="comment"># WHERE country = 'U.S.A'</span></div><div class="line"><span class="comment"># ORDER BY name DESC;</span></div></pre></td></tr></table></figure><h5 id="删除对象"><a href="#删除对象" class="headerlink" title="删除对象"></a>删除对象</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 删除数据库中的对象</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Publisher.objects.get(name=<span class="string">"O'Reilly"</span>).delete()</div><div class="line"><span class="comment"># 调用delete()方法同时删除多条记录</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Publisher.objects.filter(country=<span class="string">'USA'</span>).delete()</div></pre></td></tr></table></figure></div><div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Django/" rel="tag">#Django</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/02/17/改善python程序-库/" rel="next" title="改善python程序-库"><i class="fa fa-chevron-left"></i> 改善python程序-库</a></div><div class="post-nav-prev post-nav-item"><a href="/2017/02/21/Django-REST入门/" rel="prev" title="Django-REST入门">Django-REST入门 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Sambeau Wang"><p class="site-author-name" itemprop="name">Sambeau Wang</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">10</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">4</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/SambeauWang" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub </a></span><span class="links-of-author-item"><a href="sambeauwang@gmail.com" target="_blank" title="Gmail"><i class="fa fa-fw fa-gmail"></i> Gmail</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、安装python和Django"><span class="nav-number">1.</span> <span class="nav-text">1、安装python和Django</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、初始化项目："><span class="nav-number">2.</span> <span class="nav-text">2、初始化项目：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、视图和URL配置"><span class="nav-number">3.</span> <span class="nav-text">3、视图和URL配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-创建一个views-py文件："><span class="nav-number">3.1.</span> <span class="nav-text">(1)创建一个views.py文件：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-修改view-py-URLconf是-URL-模式以及要为该-URL-模式调用的视图函数之间的映射表。"><span class="nav-number">3.2.</span> <span class="nav-text">(2)修改view.py:URLconf是 URL 模式以及要为该 URL 模式调用的视图函数之间的映射表。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ps"><span class="nav-number">3.3.</span> <span class="nav-text">Ps:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-动态URL"><span class="nav-number">3.4.</span> <span class="nav-text">(3)动态URL</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、模板"><span class="nav-number">4.</span> <span class="nav-text">4、模板</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Python代码中使用Django模板的最基本方式如下："><span class="nav-number">4.1.</span> <span class="nav-text">(1)Python代码中使用Django模板的最基本方式如下：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-模板渲染"><span class="nav-number">4.2.</span> <span class="nav-text">(2)模板渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-标签"><span class="nav-number">4.3.</span> <span class="nav-text">(3)标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-过滤器"><span class="nav-number">4.4.</span> <span class="nav-text">(4)过滤器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-在视图中使用模板"><span class="nav-number">4.5.</span> <span class="nav-text">(5)在视图中使用模板</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#修改视图代码"><span class="nav-number">4.5.0.1.</span> <span class="nav-text">修改视图代码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#render-to-response"><span class="nav-number">4.5.0.2.</span> <span class="nav-text">render_to_response</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-include模板标签"><span class="nav-number">4.6.</span> <span class="nav-text">(6)include模板标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-模板继承"><span class="nav-number">4.7.</span> <span class="nav-text">(7)模板继承</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5、模型"><span class="nav-number">4.8.</span> <span class="nav-text">5、模型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-MTV-开发模式"><span class="nav-number">4.8.0.1.</span> <span class="nav-text">(1) MTV 开发模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-数据库配置"><span class="nav-number">4.8.0.2.</span> <span class="nav-text">(2) 数据库配置</span></a></li></ol></li></ol><li class="nav-item nav-level-3"><a class="nav-link" href="#3-project和app之间的区别"><span class="nav-number">4.9.</span> <span class="nav-text">(3)project和app之间的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-第一个模型-书籍-作者-出版商-数据库结构"><span class="nav-number">4.10.</span> <span class="nav-text">(4)第一个模型(书籍/作者/出版商 数据库结构)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#模型定义"><span class="nav-number">4.10.0.1.</span> <span class="nav-text">模型定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#模型安装"><span class="nav-number">4.10.0.2.</span> <span class="nav-text">模型安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-基本数据访问"><span class="nav-number">4.11.</span> <span class="nav-text">(5)基本数据访问</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#添加模块的字符串表现"><span class="nav-number">4.11.0.1.</span> <span class="nav-text">添加模块的字符串表现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#插入和更新数据"><span class="nav-number">4.11.0.2.</span> <span class="nav-text">插入和更新数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#选择对象"><span class="nav-number">4.11.0.3.</span> <span class="nav-text">选择对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#数据排序"><span class="nav-number">4.11.0.4.</span> <span class="nav-text">数据排序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#连锁查询"><span class="nav-number">4.11.0.5.</span> <span class="nav-text">连锁查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#删除对象"><span class="nav-number">4.11.0.6.</span> <span class="nav-text">删除对象</span></a></li></ol></li></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2017</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Sambeau Wang</span></div><div class="powered-by"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>本站总访问量 <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp 您是第<span id="busuanzi_value_site_uv"></span>个来到的小伙伴</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script><script type="text/javascript">function run_disqus_script(s){var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src="//"+disqus_shortname+".disqus.com/"+s,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(i)}var disqus_shortname="sambeaublog.disqus.com/admin",disqus_identifier="2017/02/18/Django入门/",disqus_title="Django入门",disqus_url="http://yoursite.com/2017/02/18/Django入门/";run_disqus_script("count.js");var disqus_config=function(){this.page.url=disqus_url,this.page.identifier=disqus_identifier,this.page.title=disqus_title};run_disqus_script("embed.js")</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("MmTla9uHtyvAotAPz2aHArnn-gzGzoHsz","ppTjU9IN1rosOHlnsYjpxXJe")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html>